<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Search Offers</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 800px; margin: auto; }
    label { display: block; margin-top: 10px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #f0f0f0; }
  </style>
</head>
<body>

  <h2>Search Offers</h2>

  <label>Origin:
    <input type="text" id="origin" value="City51" />
  </label>

  <label>Destination:
    <input type="text" id="destination" value="City2" />
  </label>

  <label>Date:
    <input type="date" id="date" value="2025-04-22" />
  </label>

  <label>Transport Type:
    <select id="transport">
      <option value="bus">Bus</option>
      <option value="train">Train</option>
      <option value="flight">Flight</option>
    </select>
  </label>

  <label>Number of People:
    <input type="number" id="people" value="1" />
  </label>

  <label>
    <input type="checkbox" id="promotion" />
    Promotion Only
  </label>

  <button id="searchBtn">Search</button>

  <div id="results" style="margin-top: 30px;"></div>

  <script>
    document.getElementById("searchBtn").addEventListener("click", async () => {
      const params = new URLSearchParams({
        people: document.getElementById("people").value,
        transport: document.getElementById("transport").value,
        date: document.getElementById("date").value,
        promotion: document.getElementById("promotion").checked,
        origin: document.getElementById("origin").value,
        destination: document.getElementById("destination").value
      });

      try {
        const res = await fetch(`http://localhost:5035/api/offers/search?${params}`);
        const offers = await res.json();
        renderResults(offers);
      } catch (err) {
        document.getElementById("results").innerHTML =
          '<p style="color:red">❌ Error fetching data.</p>';
        console.error(err);
      }
    });

    function renderResults(offers) {
      if (!offers.length) {
        document.getElementById("results").innerHTML =
          '<p style="color:orange">⚠️ No offers found.</p>';
        return;
      }

      const html = [
        '<table><tr><th>From</th><th>To</th><th>Date</th><th>Type</th><th>Seats</th><th>Promo</th></tr>'
      ];
      for (const o of offers) {
        html.push(`<tr>
          <td>${o.fromCity}</td>
          <td>${o.toCity}</td>
          <td>${o.departureTime ? o.departureTime.split('T')[0] : ''}</td>
          <td>${o.transportType}</td>
          <td>${o.availableSeats}</td>
          <td>${o.usePromotion ? 'Yes' : 'No'}</td>
        </tr>`);
      }
      html.push('</table>');
      document.getElementById("results").innerHTML = html.join('');
    }
  </script>

</body>
</html>

